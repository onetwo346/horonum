<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Horonum </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #2b0a5a, #5a0a2b);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Intro Page */
        #intro-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            animation: starPulse 10s infinite;
            position: relative;
            padding: 20px;
        }

        @keyframes starPulse {
            0% { background: linear-gradient(135deg, #2b0a5a, #5a0a2b); }
            50% { background: linear-gradient(135deg, #5a0a2b, #2b0a5a); }
            100% { background: linear-gradient(135deg, #2b0a5a, #5a0a2b); }
        }

        #intro-page h1 {
            font-size: 3rem;
            text-shadow: 0 0 15px #ffcc00;
            margin-bottom: 20px;
        }

        #intro-page p {
            font-size: 1.2rem;
            margin-bottom: 30px;
        }

        .insight-btn {
            padding: 15px 40px;
            font-size: 1.5rem;
            background: #ffcc00;
            border: none;
            border-radius: 50px;
            color: #2b0a5a;
            cursor: pointer;
            animation: glow 2s infinite;
            transition: transform 0.3s;
        }

        .insight-btn:hover {
            transform: scale(1.1);
        }

        @keyframes glow {
            0% { box-shadow: 0 0 10px #ffcc00; }
            50% { box-shadow: 0 0 25px #ffcc00, 0 0 50px rgba(255, 204, 0, 0.5); }
            100% { box-shadow: 0 0 10px #ffcc00; }
        }

        .support-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 25px;
            background: #00ccff;
            border-radius: 25px;
            color: #2b0a5a;
            text-decoration: none;
            font-size: 1.1rem;
            transition: transform 0.3s;
            animation: bounce 3s infinite;
            z-index: 1000;
        }

        .support-btn:hover {
            transform: scale(1.1);
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Main Page */
        #main-page {
            display: none;
            min-height: 100vh;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .celestial-interface {
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .star-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .star-btn {
            padding: 15px 30px;
            background: #ffcc00;
            border: 2px solid #ffcc00;
            border-radius: 10px;
            color: #2b0a5a;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .star-btn.active {
            background: transparent;
            color: #ffcc00;
        }

        .star-btn:hover {
            transform: scale(1.05);
        }

        .input-constellation {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 20px;
            width: 100%;
            border: 2px dashed #ffcc00;
            margin-bottom: 20px;
        }

        .input-constellation input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background: transparent;
            border: 2px solid #ffcc00;
            border-radius: 20px;
            color: #fff;
            font-size: 1rem;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .generate-btn, .clear-btn {
            padding: 10px 40px;
            border: none;
            border-radius: 50px;
            color: #2b0a5a;
            cursor: pointer;
            font-size: 1.1rem;
            transition: transform 0.3s;
        }

        .generate-btn {
            background: #00ccff;
        }

        .clear-btn {
            background: #ff6666;
        }

        .generate-btn:hover, .clear-btn:hover {
            transform: scale(1.05);
        }

        .output-sphere {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 20px;
            width: 100%;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ffcc00;
            position: relative;
            margin-top: 20px;
        }

        .spin-info {
            font-size: 0.8rem;
            color: #ffcc00;
            margin-top: 10px;
            text-align: center;
        }

        .learn-more-btn {
            margin-top: 20px;
            padding: 10px 20px;
            background: #ffcc00;
            border: none;
            border-radius: 20px;
            color: #2b0a5a;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .learn-more-btn:hover {
            transform: scale(1.05);
        }
        
        /* Natal Chart Styles */
        .chart-options {
            margin: 15px 0;
        }
        
        .option-group {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .option-group label {
            margin-right: 10px;
            min-width: 120px;
            color: #ffcc00;
        }
        
        .option-group select {
            flex: 1;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 204, 0, 0.5);
            border-radius: 5px;
            color: white;
        }
        
        .chart-display {
            margin-top: 20px;
            text-align: center;
        }
        
        #natal-chart {
            max-width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 204, 255, 0.3);
        }
        
        .chart-info {
            margin-top: 10px;
            white-space: pre-line;
            text-align: left;
            font-family: monospace;
            font-size: 0.8rem;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            border-radius: 5px;
            background: rgba(0, 0, 0, 0.3);
        }
        
        .analysis-section {
            margin-top: 20px;
        }
        
        .analysis-tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255, 204, 0, 0.3);
            overflow-x: auto;
        }
        
        .analysis-tab {
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
        }
        
        .analysis-tab.active {
            color: #ffcc00;
            border-bottom: 2px solid #ffcc00;
        }
        
        .analysis-content {
            padding: 10px 0;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .planet-item, .house-item, .aspect-item, .pattern-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .planet-header, .house-header, .aspect-header, .pattern-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: bold;
            color: #00ccff;
        }
        
        .planet-description, .house-description, .aspect-description, .pattern-description {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.4;
        }
        
        .save-btn {
            display: block;
            margin: 15px auto 0;
            padding: 8px 20px;
            background: #ffcc00;
            border: none;
            border-radius: 20px;
            color: #2b0a5a;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .save-btn:hover {
            transform: scale(1.05);
        }
        
        /* Unified My Astro Chart Styles */
        .unified-output {
            margin-top: 30px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 204, 0, 0.3);
        }
        
        .main-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
        }
        
        .main-tab {
            padding: 12px 25px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 204, 0, 0.5);
            border-radius: 30px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 1.1rem;
        }
        
        .main-tab.active {
            background: rgba(255, 204, 0, 0.2);
            border-color: #ffcc00;
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.3);
            color: #ffcc00;
        }
        
        .main-tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .tab-section {
            margin-top: 20px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            #intro-page h1 { font-size: 2.5rem; }
            .star-selector { flex-direction: column; gap: 10px; }
            .support-btn { padding: 10px 20px; font-size: 1rem; }
            .button-group { flex-direction: column; gap: 10px; }
        }

        @media (max-width: 480px) {
            #intro-page h1 { font-size: 2rem; }
            .insight-btn { font-size: 1rem; padding: 10px 20px; }
            .star-btn { padding: 10px 20px; font-size: 0.9rem; }
            .output-sphere { max-height: 200px; }
            .support-btn { padding: 8px 15px; font-size: 0.9rem; bottom: 80px; }
        }

        @media only screen and (max-device-width: 812px) and (-webkit-device-pixel-ratio: 3) {
            .support-btn {
                bottom: 80px;
                right: 15px;
                padding: 12px 25px;
                font-size: 1.2rem;
                background: #00ccff;
                animation: bounce 2s infinite;
            }
        }
    </style>
</head>
<body>
    <!-- Intro Page -->
    <div id="intro-page">
        <h1> Horonum </h1>
        <p>Unlock Your Daily Horoscope Secrets </p>
        <button class="insight-btn" onclick="showMainPage()">Discover Your Destiny</button>
        <a href="https://buy.stripe.com/00g16Q5xv4Cw05G6oo" class="support-btn">Support Us</a>
    </div>

    <!-- Main Page -->
    <div id="main-page">
        <div class="celestial-interface">
            <div class="star-selector">
                <div class="star-btn active" onclick="selectMode('astrochart')">My Astro Chart</div>
            </div>
            <div class="input-constellation" id="astro-input">
                <h3>Your Cosmic Identity</h3>
                <input type="text" id="unified-name" placeholder="Your Full Name">
                <input type="date" id="unified-birthdate" placeholder="Birth Date">
                <input type="time" id="unified-birthtime" placeholder="Birth Time" value="12:00">
                <input type="text" id="unified-birthplace" placeholder="Birth Place (City, Country)" value="New York, USA">
                
                <h3>Chart Options</h3>
                <div class="chart-options">
                    <div class="option-group">
                        <label>House System:</label>
                        <select id="house-system">
                            <option value="placidus">Placidus</option>
                            <option value="koch">Koch</option>
                            <option value="equal">Equal House</option>
                            <option value="whole">Whole Sign</option>
                        </select>
                    </div>
                    
                    <div class="option-group">
                        <label>Chart Detail Level:</label>
                        <select id="chart-detail">
                            <option value="basic">Basic</option>
                            <option value="detailed" selected>Detailed</option>
                            <option value="professional">Professional</option>
                        </select>
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="generate-btn" id="generate-unified">Generate Complete Chart</button>
                    <button class="clear-btn" id="clear-unified">Clear</button>
                </div>
            </div>
            <!-- Unified Output Container -->
            <div class="unified-output" id="unified-output" style="display: none;">
                <!-- Main Tabs Navigation -->
                <div class="main-tabs">
                    <div class="main-tab active" data-section="daily">Daily Horoscope</div>
                    <div class="main-tab" data-section="numerology">Numerology</div>
                    <div class="main-tab" data-section="natal">Natal Chart</div>
                </div>
                
                <!-- Daily Horoscope Section -->
                <div class="tab-section" id="daily-section">
                    <div class="output-sphere" id="horoscope-output"></div>
                    <button class="insight-btn" id="more-horoscope-btn">Deeper Insights</button>
                </div>
                
                <!-- Numerology Section -->
                <div class="tab-section" id="numerology-section" style="display: none;">
                    <div class="output-sphere" id="numerology-output"></div>
                    <button class="insight-btn" id="more-numerology-btn">Deeper Insights</button>
                </div>
                
                <!-- Natal Chart Section -->
                <div class="tab-section" id="natal-section" style="display: none;">
                    <!-- Chart Display -->
                    <div class="chart-display">
                        <canvas id="natal-chart" width="600" height="600">Your browser does not support canvas</canvas>
                        <div id="chart-info" class="chart-info"></div>
                    </div>
                    
                    <!-- Chart Analysis Tabs -->
                    <div class="analysis-section" id="chart-analysis">
                        <div class="analysis-tabs">
                            <div class="analysis-tab active" data-tab="planets">Planets</div>
                            <div class="analysis-tab" data-tab="houses">Houses</div>
                            <div class="analysis-tab" data-tab="aspects">Aspects</div>
                            <div class="analysis-tab" data-tab="patterns">Patterns</div>
                        </div>
                        <div class="analysis-content" id="analysis-content">
                            <div class="loading-message">Generate your chart to see the analysis</div>
                        </div>
                        <button class="save-btn" id="save-chart">Save Chart Image</button>
                    </div>
                </div>
            </div>
            
            <div class="spin-info" id="cosmic-info">The stars align to reveal your complete cosmic destiny!</div>
        </div>
    </div>

    <script>
        let selectedMode = 'astrochart';
        let userData = {};
        let activeSection = 'daily';

        function showMainPage() {
            document.getElementById('intro-page').style.display = 'none';
            document.getElementById('main-page').style.display = 'flex';
        }

        function selectMode(mode) {
            selectedMode = mode;
            document.querySelectorAll('.star-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // For the unified astrochart mode
            if (mode === 'astrochart') {
                // Show the unified input form
                document.getElementById('astro-input').style.display = 'block';
                document.getElementById('cosmic-info').style.display = 'block';
                
                // Initialize event listeners for the unified interface
                initializeUnifiedInterface();
            }
        }
        
        function initializeUnifiedInterface() {
            // Add event listeners for main tabs if not already done
            if (!window.unifiedInitialized) {
                // Main tab navigation
                document.querySelectorAll('.main-tab').forEach(tab => {
                    tab.addEventListener('click', function() {
                        // Update active tab
                        document.querySelectorAll('.main-tab').forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        
                        // Show corresponding section
                        const section = this.getAttribute('data-section');
                        activeSection = section;
                        showSection(section);
                    });
                });
                
                // Generate button
                document.getElementById('generate-unified').addEventListener('click', generateUnifiedChart);
                
                // Clear button
                document.getElementById('clear-unified').addEventListener('click', clearUnifiedChart);
                
                // Deeper insights buttons
                document.getElementById('more-horoscope-btn').addEventListener('click', function() {
                    showMoreInsights('horoscope');
                });
                
                document.getElementById('more-numerology-btn').addEventListener('click', function() {
                    showMoreInsights('numerology');
                });
                
                // Add deeper insights for natal chart tabs (optional, placeholder)
                setTimeout(function() {
                    ['planets','houses','aspects','patterns'].forEach(function(tab) {
                        const container = document.getElementById('analysis-content');
                        if (container && !document.getElementById('more-' + tab + '-btn')) {
                            const btn = document.createElement('button');
                            btn.className = 'insight-btn';
                            btn.id = 'more-' + tab + '-btn';
                            btn.innerText = 'Deeper Insights';
                            btn.style.margin = '10px 0';
                            btn.onclick = function() {
                                container.innerHTML += `<div class="loading-message">Deeper insights for ${tab} coming soon!</div>`;
                                btn.style.display = 'none';
                            };
                            container.appendChild(btn);
                        }
                    });
                }, 1000);
                
                // Initialize chart controller
                initializeChartController();
                
                window.unifiedInitialized = true;
            }
        }
        
        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.tab-section').forEach(s => {
                s.style.display = 'none';
            });
            
            // Show the selected section
            document.getElementById(section + '-section').style.display = 'block';
        }

        function generateInsight() {
            const name = document.getElementById('name').value.trim();
            const birthdate = document.getElementById('birthdate').value;
            if (!name || !birthdate) {
                alert('Please enter your name and birth date!');
                return;
            }

            const date = new Date(birthdate);
            const day = date.getDate();
            const month = date.getMonth() + 1;
            const zodiac = getZodiac(month, day);
            let output = '';

            userData = { name, zodiac, birthdate };

            if (selectedMode === 'horoscope') {
                output = generateHoroscope(name, zodiac);
            } else {
                output = generateNumerology(name, birthdate);
            }

            document.getElementById('output').innerHTML = output;
            document.getElementById('learn-more-btn').style.display = 'block';
        }

        function generateUnifiedChart() {
            const name = document.getElementById('unified-name').value.trim();
            const birthdate = document.getElementById('unified-birthdate').value;
            const birthtime = document.getElementById('unified-birthtime').value || '12:00';
            const birthplace = document.getElementById('unified-birthplace').value || 'New York, USA';
            
            if (!name || !birthdate) {
                alert('Please enter your name and birth date!');
                return;
            }
            
            // Store user data
            userData = { 
                name, 
                birthdate, 
                birthtime, 
                birthplace 
            };
            
            // Parse date for zodiac and numerology
            const date = new Date(birthdate);
            const day = date.getDate();
            const month = date.getMonth() + 1;
            const zodiac = getZodiac(month, day);
            userData.zodiac = zodiac;
            
            // Generate all three types of insights
            generateHoroscopeInsight(name, zodiac);
            generateNumerologyInsight(name, birthdate);
            generateNatalChartInsight(name, birthdate, birthtime, birthplace);
            
            // Show the output container
            document.getElementById('unified-output').style.display = 'block';
            document.getElementById('cosmic-info').style.display = 'none';
            
            // Show the active section
            showSection(activeSection);
        }
        
        function generateHoroscopeInsight(name, zodiac) {
            const messages = [
                `Greetings, ${name}. As a ${zodiac}, today heralds a wave of transformation. Unexpected opportunities beckon—embrace them boldly, for the stars favor your courage.`,
                `${name}, your ${zodiac} essence radiates today. Prioritize self-care and seek inner tranquility; the cosmos rewards your balance with clarity and peace.`,
                `The universe speaks to ${name}: under ${zodiac}'s celestial gaze, your instincts are your compass. Trust them, and let intuition guide your path through today's mysteries.`
            ];
            const randomIdx = Math.floor(Math.random() * messages.length);
            document.getElementById('horoscope-output').innerHTML = `<h3>Your ${zodiac} Horoscope</h3><p>${messages[randomIdx]}</p>`;
        }
        
        function generateNumerologyInsight(name, birthdate) {
            const date = new Date(birthdate);
            let sum = date.getDate() + (date.getMonth() + 1) + date.getFullYear();
            while (sum > 9) sum = sum.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
            
            const meanings = {
                1: `${name}, your Life Path 1 ignites leadership and ambition. Today, take charge—your vision shapes your future.`,
                2: `${name}, Life Path 2 calls for harmony. Seek balance in relationships and decisions; peace is your strength.`,
                3: `${name}, with Life Path 3, creativity surges. Express yourself boldly—artistry unlocks your potential today.`,
                4: `${name}, Life Path 4 rewards diligence. Hard work builds a foundation for lasting success—stay steadfast.`,
                5: `${name}, Life Path 5 stirs adventure. Embrace change and explore the unknown; freedom fuels your spirit.`,
                6: `${name}, Life Path 6 weaves love into duty. Nurture those around you—responsibility brings fulfillment.`,
                7: `${name}, Life Path 7 unveils wisdom. Reflect deeply today; introspection reveals hidden truths.`,
                8: `${name}, Life Path 8 promises power. Seize opportunities for success—ambition is your ally.`,
                9: `${name}, Life Path 9 radiates compassion. Embrace closure and aid others—your empathy transforms the day.`
            };
            document.getElementById('numerology-output').innerHTML = `<h3>Your Numerology Reading</h3><p>Life Path Number: ${sum}</p><p>${meanings[sum]}</p>`;
        }
        
        function generateNatalChartInsight(name, birthdate, birthtime, birthplace) {
            // Default coordinates (would be calculated from birthplace in a full implementation)
            const latitude = 40.7128;  // New York latitude
            const longitude = -74.0060; // New York longitude
            const houseSystem = document.getElementById('house-system').value;
            
            // Calculate natal chart
            const chartData = window.astroCalculator.calculateNatalChart(
                birthdate, 
                birthtime, 
                latitude, 
                longitude,
                houseSystem
            );
            
            // Create chart and analyzer
            const chart = new window.AstroChart('natal-chart');
            const analyzer = new window.ChartAnalyzer(chartData);
            
            // Set chart options based on detail level
            const chartMode = document.getElementById('chart-detail').value;
            const options = {
                showAspects: true,
                showDegrees: chartMode !== 'basic',
                showMinutes: chartMode === 'professional'
            };
            
            // Draw the chart
            chart.options = { ...chart.options, ...options };
            chart.drawChart(chartData);
            
            // Update chart info
            const chartInfo = document.getElementById('chart-info');
            if (chartInfo) {
                chartInfo.textContent = chart.generateSummaryText();
            }
            
            // Generate analysis
            const analysis = analyzer.generateFullAnalysis();
            
            // Show planets tab by default
            window.chartController.chartData = chartData;
            window.chartController.chart = chart;
            window.chartController.analyzer = analyzer;
            window.chartController.showAnalysisTab('planets', analysis);
        }
        
        function clearUnifiedChart() {
            // Clear input fields
            document.getElementById('unified-name').value = '';
            document.getElementById('unified-birthdate').value = '';
            document.getElementById('unified-birthtime').value = '12:00';
            document.getElementById('unified-birthplace').value = 'New York, USA';
            
            // Hide output
            document.getElementById('unified-output').style.display = 'none';
            document.getElementById('cosmic-info').style.display = 'block';
            
            // Clear all outputs
            document.getElementById('horoscope-output').innerHTML = '';
            document.getElementById('numerology-output').innerHTML = '';
            
            // Clear chart
            const canvas = document.getElementById('natal-chart');
            if (canvas) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
            
            // Clear chart info
            const chartInfo = document.getElementById('chart-info');
            if (chartInfo) {
                chartInfo.textContent = '';
            }
            
            // Clear analysis content
            const analysisContent = document.getElementById('analysis-content');
            if (analysisContent) {
                analysisContent.innerHTML = '<div class="loading-message">Generate your chart to see the analysis</div>';
            }
            
            // Reset user data
            userData = {};
        }

        function clearOutput() {
            document.getElementById('output').innerHTML = '';
            document.getElementById('learn-more-btn').style.display = 'none';
        }

        function getZodiac(month, day) {
            if ((month === 3 && day >= 21) || (month === 4 && day <= 19)) return 'Aries';
            if ((month === 4 && day >= 20) || (month === 5 && day <= 20)) return 'Taurus';
            if ((month === 5 && day >= 21) || (month === 6 && day <= 20)) return 'Gemini';
            if ((month === 6 && day >= 21) || (month === 7 && day <= 22)) return 'Cancer';
            if ((month === 7 && day >= 23) || (month === 8 && day <= 22)) return 'Leo';
            if ((month === 8 && day >= 23) || (month === 9 && day <= 22)) return 'Virgo';
            if ((month === 9 && day >= 23) || (month === 10 && day <= 22)) return 'Libra';
            if ((month === 10 && day >= 23) || (month === 11 && day <= 21)) return 'Scorpio';
            if ((month === 11 && day >= 22) || (month === 12 && day <= 21)) return 'Sagittarius';
            if ((month === 12 && day >= 22) || (month === 1 && day <= 19)) return 'Capricorn';
            if ((month === 1 && day >= 20) || (month === 2 && day <= 18)) return 'Aquarius';
            if ((month === 2 && day >= 19) || (month === 3 && day <= 20)) return 'Pisces';
            return 'Unknown';
        }

        function generateHoroscope(name, zodiac) {
            const messages = [
                `Greetings, ${name}. As a ${zodiac}, today heralds a wave of transformation. Unexpected opportunities beckon—embrace them boldly, for the stars favor your courage.`,
                `${name}, your ${zodiac} essence radiates today. Prioritize self-care and seek inner tranquility; the cosmos rewards your balance with clarity and peace.`,
                `The universe speaks to ${name}: under ${zodiac}'s celestial gaze, your instincts are your compass. Trust them, and let intuition guide your path through today’s mysteries.`
            ];
            const randomIdx = Math.floor(Math.random() * messages.length);
            return `<h3>Your ${zodiac} Horoscope</h3><p>${messages[randomIdx]}</p>`;
        }

        function generateNumerology(name, birthdate) {
            const date = new Date(birthdate);
            let sum = date.getDate() + (date.getMonth() + 1) + date.getFullYear();
            while (sum > 9) sum = sum.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
            
            const meanings = {
                1: `${name}, your Life Path 1 ignites leadership and ambition. Today, take charge—your vision shapes your future.`,
                2: `${name}, Life Path 2 calls for harmony. Seek balance in relationships and decisions; peace is your strength.`,
                3: `${name}, with Life Path 3, creativity surges. Express yourself boldly—artistry unlocks your potential today.`,
                4: `${name}, Life Path 4 rewards diligence. Hard work builds a foundation for lasting success—stay steadfast.`,
                5: `${name}, Life Path 5 stirs adventure. Embrace change and explore the unknown; freedom fuels your spirit.`,
                6: `${name}, Life Path 6 weaves love into duty. Nurture those around you—responsibility brings fulfillment.`,
                7: `${name}, Life Path 7 unveils wisdom. Reflect deeply today; introspection reveals hidden truths.`,
                8: `${name}, Life Path 8 promises power. Seize opportunities for success—ambition is your ally.`,
                9: `${name}, Life Path 9 radiates compassion. Embrace closure and aid others—your empathy transforms the day.`
            };
            return `<h3>Your Numerology Reading</h3><p>Life Path Number: ${sum}</p><p>${meanings[sum]}</p>`;
        }

        function showMoreInsights(mode) {
            let moreOutput = '';
            const { name, zodiac, birthdate } = userData;

            if (mode === 'horoscope') {
                const extraMessages = [
                    `${name}, your ${zodiac} spirit attracts luck through dialogue today. Engage in conversations—they may spark revelations.`,
                    `The stars align for ${name}, amplifying ${zodiac} traits like ingenuity. Channel this into projects—success awaits your creativity.`,
                    `${name}, ${zodiac}'s cosmic energy signals a prime moment for fresh starts. Act decisively—the universe supports your bold moves.`
                ];
                const randomIdx = Math.floor(Math.random() * extraMessages.length);
                moreOutput = `<h3>Deeper Cosmic Insights</h3><p>${extraMessages[randomIdx]}</p>`;
            } else if (mode === 'numerology') {
                const date = new Date(birthdate);
                let nameNumber = name.toLowerCase().split('').reduce((sum, char) => sum + (char.charCodeAt(0) - 96), 0);
                while (nameNumber > 9) nameNumber = nameNumber.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
                
                const nameMeanings = {
                    1: `${name}, your name vibrates with independence (Number 1). Make fearless choices today—destiny favors the daring.`,
                    2: `${name}, your name hums with unity (Number 2). Collaborate and connect—partnerships amplify your day.`,
                    3: `${name}, your name dances with creativity (Number 3). Unleash your imagination—expression is your power.`,
                    4: `${name}, your name roots in discipline (Number 4). Focus and perseverance pave your path to triumph.`,
                    5: `${name}, your name echoes freedom (Number 5). Dive into the unexpected—adventure shapes your journey.`,
                    6: `${name}, your name glows with harmony (Number 6). Strengthen bonds—love and care define your day.`,
                    7: `${name}, your name whispers mystery (Number 7). Seek inner wisdom—intuition lights your way.`,
                    8: `${name}, your name pulses with ambition (Number 8). Reach for greatness—power lies within your grasp.`,
                    9: `${name}, your name sings of kindness (Number 9). Heal and uplift others—compassion is your gift.`
                };
                moreOutput = `<h3>Deeper Numerology Insights</h3><p>Name Number: ${nameNumber}</p><p>${nameMeanings[nameNumber]}</p>`;
            }

            // Unified interface: output to correct section
            if (mode === 'horoscope') {
                document.getElementById('horoscope-output').innerHTML += moreOutput;
                document.getElementById('more-horoscope-btn').style.display = 'none';
            } else if (mode === 'numerology') {
                document.getElementById('numerology-output').innerHTML += moreOutput;
                document.getElementById('more-numerology-btn').style.display = 'none';
            } else {
                // fallback
                if (document.getElementById('output')) {
                    document.getElementById('output').innerHTML += moreOutput;
                }
                if (document.getElementById('learn-more-btn')) {
                    document.getElementById('learn-more-btn').style.display = 'none';
                }
            }
        }
    </script>
    <!-- Include our astrological chart scripts -->
    <script src="ephemeris.js"></script>
    <script src="chart.js"></script>
    <script src="analysis.js"></script>
    
    <script>
        // Chart Controller for Natal Charts
        function initializeChartController() {
            // Create chart controller
            window.chartController = {
                chartData: null,
                chart: null,
                analyzer: null,
                chartMode: 'detailed',
                houseSystem: 'placidus',
                
                initialize: function() {
                    // Add event listeners
                    document.getElementById('generate-chart').addEventListener('click', () => this.generateChart());
                    document.getElementById('clear-chart').addEventListener('click', () => this.clearChart());
                    document.getElementById('save-chart').addEventListener('click', () => this.saveChartImage());
                    
                    // House system select
                    document.getElementById('house-system').addEventListener('change', (e) => {
                        this.houseSystem = e.target.value;
                        if (this.chartData) {
                            this.generateChart();
                        }
                    });
                    
                    // Chart detail level select
                    document.getElementById('chart-detail').addEventListener('change', (e) => {
                        this.chartMode = e.target.value;
                        if (this.chartData) {
                            this.updateChartDisplay();
                        }
                    });
                    
                    // Analysis tabs
                    const analysisTabs = document.querySelectorAll('.analysis-tab');
                    analysisTabs.forEach(tab => {
                        tab.addEventListener('click', (e) => {
                            // Remove active class from all tabs
                            analysisTabs.forEach(t => t.classList.remove('active'));
                            
                            // Add active class to clicked tab
                            e.target.classList.add('active');
                            
                            // Show corresponding content
                            const tabName = e.target.getAttribute('data-tab');
                            this.showAnalysisTab(tabName);
                        });
                    });
                },
                
                generateChart: function() {
                    const name = document.getElementById('chart-name').value;
                    const birthdate = document.getElementById('chart-birthdate').value;
                    const birthtime = document.getElementById('chart-birthtime').value || '12:00';
                    const birthplace = document.getElementById('chart-birthplace').value || 'New York, USA';
                    
                    if (!name || !birthdate) {
                        alert('Please enter your name and birth date');
                        return;
                    }
                    
                    // Default coordinates (would be calculated from birthplace in a full implementation)
                    const latitude = 40.7128;  // New York latitude
                    const longitude = -74.0060; // New York longitude
                    
                    // Calculate natal chart
                    this.chartData = window.astroCalculator.calculateNatalChart(
                        birthdate, 
                        birthtime, 
                        latitude, 
                        longitude,
                        this.houseSystem
                    );
                    
                    // Create chart and analyzer
                    this.chart = new window.AstroChart('natal-chart');
                    this.analyzer = new window.ChartAnalyzer(this.chartData);
                    
                    // Show chart display
                    document.querySelector('.chart-display').style.display = 'block';
                    document.getElementById('chart-analysis').style.display = 'block';
                    
                    // Display the chart
                    this.updateChartDisplay();
                    
                    // Generate and show analysis
                    this.generateAnalysis();
                },
                
                updateChartDisplay: function() {
                    if (!this.chart || !this.chartData) return;
                    
                    // Set options based on chart mode
                    const options = {
                        showAspects: true,
                        showDegrees: this.chartMode !== 'basic',
                        showMinutes: this.chartMode === 'professional'
                    };
                    
                    // Draw the chart
                    this.chart.options = { ...this.chart.options, ...options };
                    this.chart.drawChart(this.chartData);
                    
                    // Update chart info
                    const chartInfo = document.getElementById('chart-info');
                    if (chartInfo) {
                        chartInfo.textContent = this.chart.generateSummaryText();
                    }
                },
                
                generateAnalysis: function() {
                    if (!this.analyzer) return;
                    
                    const analysis = this.analyzer.generateFullAnalysis();
                    
                    // Show planets tab by default
                    this.showAnalysisTab('planets', analysis);
                },
                
                showAnalysisTab: function(tabName, analysis = null) {
                    if (!this.analyzer && !analysis) {
                        const content = document.getElementById('analysis-content');
                        if (content) content.innerHTML = '<div class="loading-message">No chart data available. Please generate your chart first.</div>';
                        return;
                    }
                    const content = document.getElementById('analysis-content');
                    if (!content) return;
                    // If analysis not provided, use the one from the analyzer
                    const data = analysis || this.analyzer.generateFullAnalysis();
                    let html = '';
                    
                    switch (tabName) {
                        case 'planets':
                            html = this.generatePlanetsTabHTML(data.planetPositions);
                            break;
                        case 'houses':
                            html = this.generateHousesTabHTML(data.houseCusps);
                            break;
                        case 'aspects':
                            html = this.generateAspectsTabHTML(data.aspects);
                            break;
                        case 'patterns':
                            html = this.generatePatternsTabHTML(data);
                            break;
                        default:
                            html = '<div class="loading-message">No data for this tab.</div>';
                    }
                    if (!html) html = '<div class="loading-message">No data for this tab.</div>';
                    content.innerHTML = html;
                    // Always re-attach tab listeners after rendering
                    attachAnalysisTabListeners();
                },
                
                generatePlanetsTabHTML: function(planets) {
                    if (!planets || planets.length === 0) {
                        return '<div class="loading-message">No planetary data available</div>';
                    }
                    
                    let html = '<div class="planets-container">';
                    
                    planets.forEach(planet => {
                        html += `
                            <div class="planet-item">
                                <div class="planet-header">
                                    <span>${planet.symbol} ${planet.planet}</span>
                                    <span>${planet.formattedPosition} ${planet.retrograde ? '℞' : ''}</span>
                                </div>
                                <div class="planet-location">
                                    <span>House ${planet.house}</span>
                                    <span>${planet.dignity !== 'Neutral' ? planet.dignity : ''}</span>
                                </div>
                                <div class="planet-description">
                                    ${planet.interpretation}
                                </div>
                                <div class="planet-description">
                                    ${planet.houseInterpretation}
                                </div>
                                ${planet.dignity !== 'Neutral' ? `
                                    <div class="planet-description">
                                        ${planet.dignityEffect}
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    return html;
                },
                
                generateHousesTabHTML: function(houses) {
                    if (!houses || houses.length === 0) {
                        return '<div class="loading-message">No house data available</div>';
                    }
                    
                    let html = '<div class="houses-container">';
                    
                    houses.forEach(house => {
                        html += `
                            <div class="house-item">
                                <div class="house-header">
                                    <span>House ${house.house}</span>
                                    <span>${house.sign} ${house.degree}°</span>
                                </div>
                                <div class="house-description">
                                    ${house.interpretation}
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    return html;
                },
                
                generateAspectsTabHTML: function(aspects) {
                    if (!aspects || aspects.length === 0) {
                        return '<div class="loading-message">No aspect data available</div>';
                    }
                    
                    let html = '<div class="aspects-container">';
                    
                    // Major aspects first
                    const majorAspects = aspects.filter(a => 
                        ['conjunction', 'opposition', 'trine', 'square', 'sextile'].includes(a.aspect.toLowerCase())
                    );
                    
                    if (majorAspects.length > 0) {
                        html += '<h3>Major Aspects</h3>';
                        
                        majorAspects.forEach(aspect => {
                            html += `
                                <div class="aspect-item">
                                    <div class="aspect-header">
                                        <span>${aspect.planets} (${aspect.symbol})</span>
                                        <span>${aspect.angle}° (orb: ${aspect.orb}°)</span>
                                    </div>
                                    <div class="aspect-description">
                                        ${aspect.interpretation}
                                    </div>
                                </div>
                            `;
                        });
                    }
                    
                    // Minor aspects
                    const minorAspects = aspects.filter(a => 
                        !['conjunction', 'opposition', 'trine', 'square', 'sextile'].includes(a.aspect.toLowerCase())
                    );
                    
                    if (minorAspects.length > 0) {
                        html += '<h3>Minor Aspects</h3>';
                        
                        minorAspects.forEach(aspect => {
                            html += `
                                <div class="aspect-item">
                                    <div class="aspect-header">
                                        <span>${aspect.planets} (${aspect.symbol})</span>
                                        <span>${aspect.angle}° (orb: ${aspect.orb}°)</span>
                                    </div>
                                    <div class="aspect-description">
                                        ${aspect.interpretation}
                                    </div>
                                </div>
                            `;
                        });
                    }
                    
                    html += '</div>';
                    return html;
                },
                
                generatePatternsTabHTML: function(data) {
                    let html = '<div class="patterns-container">';
                    
                    // Element balance
                    if (data.elementBalance) {
                        html += `
                            <div class="pattern-item">
                                <div class="pattern-header">
                                    <span>Element Balance</span>
                                </div>
                                <div class="element-distribution">
                                    Fire: ${data.elementBalance.elements.Fire} | 
                                    Earth: ${data.elementBalance.elements.Earth} | 
                                    Air: ${data.elementBalance.elements.Air} | 
                                    Water: ${data.elementBalance.elements.Water}
                                </div>
                                <div class="pattern-description">
                                    ${data.elementBalance.interpretation}
                                </div>
                            </div>
                        `;
                    }
                    
                    // Modality balance
                    if (data.modalityBalance) {
                        html += `
                            <div class="pattern-item">
                                <div class="pattern-header">
                                    <span>Modality Balance</span>
                                </div>
                                <div class="modality-distribution">
                                    Cardinal: ${data.modalityBalance.modalities.Cardinal} | 
                                    Fixed: ${data.modalityBalance.modalities.Fixed} | 
                                    Mutable: ${data.modalityBalance.modalities.Mutable}
                                </div>
                                <div class="pattern-description">
                                    ${data.modalityBalance.interpretation}
                                </div>
                            </div>
                        `;
                    }
                    
                    // Dominant planets
                    if (data.dominantPlanets && data.dominantPlanets.length > 0) {
                        html += `
                            <div class="pattern-item">
                                <div class="pattern-header">
                                    <span>Dominant Planets</span>
                                </div>
                                <div class="dominant-planets">
                        `;
                        
                        data.dominantPlanets.forEach(planet => {
                            html += `
                                <div class="dominant-planet">
                                    <strong>${planet.planet}</strong>
                                    <div class="pattern-description">
                                        ${planet.interpretation}
                                    </div>
                                </div>
                            `;
                        });
                        
                        html += `
                                </div>
                            </div>
                        `;
                    }
                    
                    // Special patterns
                    if (data.specialPatterns && data.specialPatterns.length > 0) {
                        html += `
                            <div class="pattern-item">
                                <div class="pattern-header">
                                    <span>Special Patterns</span>
                                </div>
                        `;
                        
                        data.specialPatterns.forEach(pattern => {
                            html += `
                                <div class="special-pattern">
                                    <strong>${pattern.type}</strong> (${pattern.planets})
                                    <div class="pattern-description">
                                        ${pattern.interpretation}
                                    </div>
                                </div>
                            `;
                        });
                        
                        html += `
                            </div>
                        `;
                    }
                    
                    html += '</div>';
                    return html;
                },
                
                clearChart: function() {
                    // Clear input fields
                    document.getElementById('chart-name').value = '';
                    document.getElementById('chart-birthdate').value = '';
                    document.getElementById('chart-birthtime').value = '12:00';
                    document.getElementById('chart-birthplace').value = 'New York, USA';
                    
                    // Hide chart display
                    document.querySelector('.chart-display').style.display = 'none';
                    document.getElementById('chart-analysis').style.display = 'none';
                    
                    // Clear chart data
                    this.chartData = null;
                    this.chart = null;
                    this.analyzer = null;
                    
                    // Clear canvas
                    const canvas = document.getElementById('natal-chart');
                    if (canvas) {
                        const ctx = canvas.getContext('2d');
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                    }
                    
                    // Clear chart info
                    const chartInfo = document.getElementById('chart-info');
                    if (chartInfo) {
                        chartInfo.textContent = '';
                    }
                    
                    // Clear analysis content
                    const analysisContent = document.getElementById('analysis-content');
                    if (analysisContent) {
                        analysisContent.innerHTML = '<div class="loading-message">Generate your chart to see the analysis</div>';
                    }
                },
                
                saveChartImage: function() {
                    const canvas = document.getElementById('natal-chart');
                    if (!canvas) return;
                    
                    // Create a temporary link
                    const link = document.createElement('a');
                    link.download = 'natal-chart.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                }
            };
            
            // Initialize the controller
            window.chartController.initialize();
        }
        
        // Initialize when page loads
        // Helper: Attach listeners to analysis tabs
        function attachAnalysisTabListeners() {
            const analysisTabs = document.querySelectorAll('.analysis-tab');
            analysisTabs.forEach(tab => {
                tab.onclick = function(e) {
                    analysisTabs.forEach(t => t.classList.remove('active'));
                    e.target.classList.add('active');
                    const tabName = e.target.getAttribute('data-tab');
                    if (window.chartController && window.chartController.showAnalysisTab) {
                        window.chartController.showAnalysisTab(tabName);
                    }
                };
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Directly initialize the unified interface and input form on page load
            initializeUnifiedInterface();
            document.getElementById('astro-input').style.display = 'block';
            document.getElementById('cosmic-info').style.display = 'block';
            // Attach listeners immediately in case analysis tabs are present
            attachAnalysisTabListeners();
        });
    </script>
</body>
</html>